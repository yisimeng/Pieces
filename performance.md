# Performance

## 网络

### 1. DNS 查找时间

1. 最小化应用使用的专有域名的数量。按照路由的一般工作方式，多个域名不可避免，尽可能做好以下几点
	* 身份管理（登陆、注销、配置文件）
	* 数据服务（API端点）
	* CDN
2. 在应用启动时只需要身份管理和初始画面所需要的数据。对于其他子域名，尝试DNS预先下载
	* 如果子域名和主机在控制范围内，可配置预设URL，不返回任何数据，只返回HTTP204的状态码，然后提前对该URL发起连接
	* 使用gethostbyname执行一个明确的DNS查找。但是不同协议可能解析至不同的IP，例如，解析HTTP和HTTPS的IP可能不同。因此在连接之前解析DNS经常是无用的，对主机进行伪连接更有效。

### 2. SSL 握手时间

* 尽可能减少发起的连接数
* 复用HTTP/S 连接，设置HTTPS请求头 Connection:keep-alive，复用连接
* 使用域分片。不同主机名可以解析到相同的IP，使用相同的证书（在通配符域）。CocoaSPDY。


### 3. 网络类型

* 设计时考虑不同网络下的情况，低速网路不开启视频自动播放、分批次拉取数据等。
* 请求失败时，以指数延迟进行重试，例如：1s后重试、2s、4s...，并设置最高重试次数。
* 强制刷新之间的最短时间，如果用户要求刷新时，先查看是否已经存在相同的请求，或者与上次请求间隔是否小于最小阈值，如果满足条件则不要发送请求。
* Reachability检测到网络不可用，可以直接展示给用户，避免因为网络不可用，让用户产生不好印象。
* 不缓存网络状态，始终使用网络敏感度高的任务的最新值。
* 按网络类型下载内容，网络不好可以先下载低分辨率内容
* wifi下预先下载内容。
* 支持同步的离线存储。对游戏可以缓存近一级的详细信息，对邮件可以存储带有附件的最新的电子邮件。例如 facebook离线模式下仍然可以发送评论，在有网情况下进行数据同步



